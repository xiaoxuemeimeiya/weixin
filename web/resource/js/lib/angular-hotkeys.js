!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",["$injector",function(e){this.includeCheatSheet=!0,this.useNgRoute=e.has("ngViewDirective"),this.templateTitle="Keyboard Shortcuts:",this.templateHeader=null,this.templateFooter=null,this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4><div ng-bind-html="header" ng-if="header"></div><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div ng-bind-html="footer" ng-if="footer"></div><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">&#215;</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(e,r,t,o,n){var i=!0;function h(e,t,n,o,i,r){this.combo=e instanceof Array?e:[e],this.description=t,this.callback=n,this.action=o,this.allowIn=i,this.persistent=r,this._formated=null}Mousetrap.prototype.stopCallback=function(e,t){return!i||!(-1<(" "+t.className+" ").indexOf(" mousetrap "))&&(t.contentEditable&&"true"==t.contentEditable)},h.prototype.format=function(){if(null===this._formated){for(var e=this.combo[0].split(/[\s]/),t=0;t<e.length;t++)e[t]=function(e){var t={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓",return:"⏎",backspace:"⌫"};e=e.split("+");for(var n=0;n<e.length;n++)"mod"===e[n]&&(o.navigator&&0<=o.navigator.platform.indexOf("Mac")?e[n]="command":e[n]="ctrl"),e[n]=t[e[n]]||e[n];return e.join(" + ")}(e[t]);this._formated=e}return this._formated};var u=r.$new();u.hotkeys=[],u.helpVisible=!1,u.title=this.templateTitle,u.header=this.templateHeader,u.footer=this.templateFooter,u.toggleCheatSheet=p;var a,s={};function c(){for(var e=u.hotkeys.length;e--;){var t=u.hotkeys[e];t&&!t.persistent&&d(t)}}this.useNgRoute&&r.$on("$routeChangeSuccess",function(e,n){c(),n&&n.hotkeys&&angular.forEach(n.hotkeys,function(e){var t=e[2];("string"==typeof t||t instanceof String)&&(e[2]=[t,n]),e[5]=!1,f.apply(this,e)})}),this.includeCheatSheet&&(a=n[0],n=e[0],e=angular.element(this.template),f(this.cheatSheetHotkey,this.cheatSheetDescription,p),n!==a&&n!==a.documentElement||(n=a.body),angular.element(n).append(t(e)(u)));var l=!1;function p(){u.helpVisible=!u.helpVisible,u.helpVisible?(l=y("esc"),d("esc"),f("esc",l.description,p,null,["INPUT","SELECT","TEXTAREA"])):(d("esc"),!1!==l&&f(l))}function f(e,t,n,o,i,r){var a=["INPUT","SELECT","TEXTAREA"];if("[object Object]"===Object.prototype.toString.call(e)&&(t=e.description,n=e.callback,o=e.action,r=e.persistent,i=e.allowIn,e=e.combo),d(e),t instanceof Function?(o=n,n=t,t="$$undefined$$"):angular.isUndefined(t)&&(t="$$undefined$$"),void 0===r&&(r=!0),"function"==typeof n){var s,c=n;i instanceof Array||(i=[]);for(var l=0;l<i.length;l++)i[l]=i[l].toUpperCase(),-1!==(s=a.indexOf(i[l]))&&a.splice(s,1);n=function(e){var t=!0;if(e){var e=e.target||e.srcElement,n=e.nodeName.toUpperCase();if(-1<(" "+e.className+" ").indexOf(" mousetrap "))t=!0;else for(var o=0;o<a.length;o++)if(a[o]===n){t=!1;break}}t&&k(c.apply(this,arguments))}}"string"==typeof o?Mousetrap.bind(e,k(n),o):Mousetrap.bind(e,k(n));r=new h(e,t,n,o,i,r);return u.hotkeys.push(r),r}function d(e){var t=e instanceof h?e.combo:e;if(Mousetrap.unbind(t),angular.isArray(t)){for(var n=!0,o=t.length;o--;)n=d(t[o])&&n;return n}var i=u.hotkeys.indexOf(y(t));return-1<i&&(1<u.hotkeys[i].combo.length?u.hotkeys[i].combo.splice(u.hotkeys[i].combo.indexOf(t),1):(angular.forEach(s,function(e){var t=e.indexOf(u.hotkeys[i]);-1!==t&&e.splice(t,1)}),u.hotkeys.splice(i,1)),!0)}function y(e){if(!e)return u.hotkeys;for(var t,n=0;n<u.hotkeys.length;n++)if(-1<(t=u.hotkeys[n]).combo.indexOf(e))return t;return!1}function k(i){return function(e,t){var n,o;i instanceof Array&&(n=i[0],o=i[1],i=function(e){o.scope.$eval(n)}),r.$apply(function(){i(e,y(t))})}}return{add:f,del:d,get:y,bindTo:function(t){return t.$id in s||(s[t.$id]=[],t.$on("$destroy",function(){for(var e=s[t.$id].length;e--;)d(s[t.$id].pop())})),{add:function(e){e=1<arguments.length?f.apply(this,arguments):f(e);return s[t.$id].push(e),this}}},template:this.template,toggleCheatSheet:p,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:c,templateTitle:this.templateTitle,pause:function(){i=!1},unpause:function(){i=!0}}}]}]).directive("hotkey",["hotkeys",function(r){return{restrict:"A",link:function(e,t,n){var o,i=[];angular.forEach(e.$eval(n.hotkey),function(e,t){o="string"==typeof n.hotkeyAllowIn?n.hotkeyAllowIn.split(/[\s,]+/):[],i.push(t),r.add({combo:t,description:n.hotkeyDescription,callback:e,action:n.hotkeyAction,allowIn:o})}),t.bind("$destroy",function(){angular.forEach(i,r.del)})}}}]).run(["hotkeys",function(e){}])}(),function(e,o){for(var i,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},n={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},s={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},t=1;t<20;++t)r[111+t]="f"+t;for(t=0;t<=9;++t)r[t+96]=t;function g(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function v(e){if("keypress"!=e.type)return r[e.which]||n[e.which]||String.fromCharCode(e.which).toLowerCase();var t=String.fromCharCode(e.which);return t=!e.shiftKey?t.toLowerCase():t}function b(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function c(e,t,n){return n="keypress"==(n=n||(function(){if(!i)for(var e in i={},r)95<e&&e<112||r.hasOwnProperty(e)&&(i[r[e]]=e);return i}()[e]?"keydown":"keypress"))&&t.length?"keydown":n}function $(e,t){for(var n,o=[],i="+"===(e=e)?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+"),r=0;r<i.length;++r)n=i[r],s[n]&&(n=s[n]),t&&"keypress"!=t&&a[n]&&(n=a[n],o.push("shift")),b(n)&&o.push(n);return{key:n,modifiers:o,action:t=c(n,o,t)}}function w(e){var p=this;if(e=e||o,!(p instanceof w))return new w(e);p.target=e,p._callbacks={},p._directMap={};var c,f={},l=!1,h=!1,u=!1;function d(e){e=e||{};var t,n=!1;for(t in f)e[t]?n=!0:f[t]=0;n||(u=!1)}function y(e,t,n,o,i,r){var a,s=[],c=n.type;if(!p._callbacks[e])return[];for("keyup"==c&&b(e)&&(t=[e]),a=0;a<p._callbacks[e].length;++a){var l,h,u=p._callbacks[e][a];!o&&u.seq&&f[u.seq]!=u.level||c==u.action&&(("keypress"!=c||n.metaKey||n.ctrlKey)&&(l=t,h=u.modifiers,l.sort().join(",")!==h.sort().join(","))||(l=!o&&u.combo==i,h=o&&u.seq==o&&u.level==r,(l||h)&&p._callbacks[e].splice(a,1),s.push(u)))}return s}function k(e,t,n,o){p.stopCallback(t,t.target||t.srcElement,n,o)||!1===e(t,n)&&((n=t).preventDefault?n.preventDefault():n.returnValue=!1,(t=t).stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function t(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t,n=v(e);n&&("keyup"!=e.type||l!==n?p.handleKey(n,(t=[],(n=e).shiftKey&&t.push("shift"),n.altKey&&t.push("alt"),n.ctrlKey&&t.push("ctrl"),n.metaKey&&t.push("meta"),t),e):l=!1)}function a(t,e,n,o){function i(e){return function(){u=e,++f[t],clearTimeout(c),c=setTimeout(d,1e3)}}function r(e){k(n,e,t),"keyup"!==o&&(l=v(e)),setTimeout(d,10)}for(var a=f[t]=0;a<e.length;++a){var s=a+1===e.length?r:i(o||$(e[a+1]).action);m(e[a],s,o,t,a)}}function m(e,t,n,o,i){p._directMap[e+":"+n]=t;var r=(e=e.replace(/\s+/g," ")).split(" ");1<r.length?a(e,r,t,n):(n=$(e,n),p._callbacks[n.key]=p._callbacks[n.key]||[],y(n.key,n.modifiers,{type:n.action},o,e,i),p._callbacks[n.key][o?"unshift":"push"]({callback:t,modifiers:n.modifiers,action:n.action,seq:o,level:i,combo:e}))}p._handleKey=function(e,t,n){for(var o=y(e,t,n),i={},r=0,a=!1,s=0;s<o.length;++s)o[s].seq&&(r=Math.max(r,o[s].level));for(s=0;s<o.length;++s)o[s].seq?o[s].level==r&&(a=!0,i[o[s].seq]=1,k(o[s].callback,n,o[s].combo,o[s].seq)):a||k(o[s].callback,n,o[s].combo);t="keypress"==n.type&&h;n.type!=u||b(e)||t||d(i),h=a&&"keydown"==n.type},p._bindMultiple=function(e,t,n){for(var o=0;o<e.length;++o)m(e[o],t,n)},g(e,"keypress",t),g(e,"keydown",t),g(e,"keyup",t)}w.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},w.prototype.unbind=function(e,t){return this.bind.call(this,e,function(){},t)},w.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},w.prototype.reset=function(){return this._callbacks={},this._directMap={},this},w.prototype.stopCallback=function(e,t){return!(-1<(" "+t.className+" ").indexOf(" mousetrap "))&&(!function e(t,n){return t!==o&&(t===n||e(t.parentNode,n))}(t,this.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},w.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},(w.init=function(){var e,t=w(o);for(e in t)"_"!==e.charAt(0)&&(w[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))})(),e.Mousetrap=w,"undefined"!=typeof module&&module.exports&&(module.exports=w),"function"==typeof define&&define.amd&&define(function(){return w})}(window,document);